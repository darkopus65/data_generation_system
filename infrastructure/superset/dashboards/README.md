# –î–∞—à–±–æ—Ä–¥—ã Superset –¥–ª—è Game Analytics

–ì–æ—Ç–æ–≤—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –¥–∞—à–±–æ—Ä–¥–æ–≤.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ó–∞–ø—É—Å–∫ ClickHouse + Superset
cd infrastructure
docker-compose up -d

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
cd ..
python generate.py --seed 42

# –ó–∞–≥—Ä—É–∑–∫–∞ –≤ ClickHouse
python scripts/load_to_clickhouse.py --input output/run_*/events.jsonl.gz --truncate
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
pip install requests
python scripts/setup_superset_dashboards.py
```

### 3. –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ Superset: http://localhost:8088 (admin / admin123)
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ ClickHouse (—Å–º. –Ω–∏–∂–µ)
3. –°–æ–∑–¥–∞–π—Ç–µ —á–∞—Ä—Ç—ã –∏–∑ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤
4. –°–æ–±–µ—Ä–∏—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã

---

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ClickHouse

1. **Settings** ‚Üí **Database Connections** ‚Üí **+ Database**
2. –í—ã–±–µ—Ä–∏—Ç–µ **ClickHouse Connect**
3. –í–≤–µ–¥–∏—Ç–µ connection string:

```
clickhousedb://superset:superset123@clickhouse:8123/game_analytics
```

4. –ù–∞–∂–º–∏—Ç–µ **Test Connection** ‚Üí **Connect**

---

## –î–∞—à–±–æ—Ä–¥—ã

### üìä Dashboard 1: Retention

–ú–µ—Ç—Ä–∏–∫–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

| –ß–∞—Ä—Ç | –¢–∏–ø | SQL –∑–∞–ø—Ä–æ—Å |
|------|-----|------------|
| DAU (Daily Active Users) | Line Chart | #1 |
| Retention –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º | Table | #2 |
| –£—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º | Stacked Area | #3 |
| –°–µ—Å—Å–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | Line Chart | #4 |
| –°—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ | Line Chart | #5 |
| Retention –º–∞—Ç—Ä–∏—Ü–∞ | Pivot Table | #6 |

**–°–æ–∑–¥–∞–Ω–∏–µ DAU —á–∞—Ä—Ç–∞:**
1. **Charts** ‚Üí **+ Chart**
2. Dataset: *Create chart from SQL*
3. –í—Å—Ç–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å #1 –∏–∑ `sql_queries.sql`
4. Chart Type: **Time-series Line Chart**
5. X-Axis: `date`, Y-Axis: `dau`
6. Save to dashboard: "Retention"

---

### üí∞ Dashboard 2: Monetization

–ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏.

| –ß–∞—Ä—Ç | –¢–∏–ø | SQL –∑–∞–ø—Ä–æ—Å |
|------|-----|------------|
| Revenue –ø–æ –¥–Ω—è–º | Line Chart | #7 |
| ARPDAU | Line Chart | #8 |
| –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º | Bar Chart | #9 |
| –ü—Ä–æ–¥—É–∫—Ç—ã –ø–æ revenue | Pie Chart | #10 |
| VIP Level —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | Pie Chart | #11 |
| LTV –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º | Line Chart | #12 |

---

### üß™ Dashboard 3: A/B Tests

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã A/B —Ç–µ—Å—Ç–æ–≤.

| –ß–∞—Ä—Ç | –¢–∏–ø | SQL –∑–∞–ø—Ä–æ—Å |
|------|-----|------------|
| Onboarding Length - Retention | Grouped Bar | #13 |
| Onboarding Length - Conversion | Grouped Bar | #14 |
| Starter Pack Price | Table | #15 |
| Gacha Pity Display | Table | #16 |
| –í—Å–µ —Ç–µ—Å—Ç—ã - —Å–≤–æ–¥–∫–∞ | Table | #17 |

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è A/B —á–∞—Ä—Ç–∞:**
1. **SQL Lab** ‚Üí New Query
2. –í—Å—Ç–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å #17
3. **Save** ‚Üí Save as Dataset: "ab_tests_summary"
4. **Charts** ‚Üí **+ Chart**
5. Dataset: "ab_tests_summary"
6. Chart Type: **Table**
7. Columns: test_name, variant, users, d7_retention, conversion

---

### üìà Dashboard 4: Funnel & Engagement

–í–æ—Ä–æ–Ω–∫–∏ –∏ –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å.

| –ß–∞—Ä—Ç | –¢–∏–ø | SQL –∑–∞–ø—Ä–æ—Å |
|------|-----|------------|
| –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ | Funnel | #18 |
| –°–æ–±—ã—Ç–∏—è –ø–æ —Ç–∏–ø–∞–º | Bar Chart | #19 |
| –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≥–ª–∞–≤–∞–º | Bar Chart | #20 |
| –ö–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ | Table | #21 |
| –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã | Pie Chart | #22 |
| –°—Ç—Ä–∞–Ω—ã | Bar Chart / Map | #23 |
| –ê–Ω–æ–º–∞–ª–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ | Line + Annotation | #24, #25 |

---

## –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ä—Ç–æ–≤ –∏–∑ SQL

### –í–∞—Ä–∏–∞–Ω—Ç 1: SQL Lab (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **SQL Lab** ‚Üí **SQL Editor**
2. –í—ã–±–µ—Ä–∏—Ç–µ Database: "ClickHouse Game Analytics"
3. –í—Å—Ç–∞–≤—å—Ç–µ SQL –∑–∞–ø—Ä–æ—Å
4. **Run**
5. **Save** ‚Üí **Save as Dataset**
6. –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–π—Ç–µ Chart –∏–∑ —ç—Ç–æ–≥–æ Dataset

### –í–∞—Ä–∏–∞–Ω—Ç 2: Chart Builder

1. **Charts** ‚Üí **+ Chart**
2. **Create chart from SQL**
3. –í—Å—Ç–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Å–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

---

## –¢–∏–ø—ã —á–∞—Ä—Ç–æ–≤ Superset

| –î–∞–Ω–Ω—ã–µ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —á–∞—Ä—Ç |
|--------|-------------------|
| –ú–µ—Ç—Ä–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ | Time-series Line Chart |
| –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π | Bar Chart |
| –î–æ–ª–∏/—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ | Pie Chart |
| –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ | Table |
| A/B —Ç–µ—Å—Ç | Grouped Bar Chart |
| –í–æ—Ä–æ–Ω–∫–∞ | Funnel Chart |
| Retention –º–∞—Ç—Ä–∏—Ü–∞ | Pivot Table |
| –ì–µ–æ-–¥–∞–Ω–Ω—ã–µ | World Map |

---

## –§–∏–ª—å—Ç—Ä—ã –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤

–î–æ–±–∞–≤—å—Ç–µ Native Filters –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **Settings** ‚Üí **Add filter**
3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:
   - **Date range** ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
   - **Platform** ‚Äî ios/android
   - **Country** ‚Äî —Å—Ç—Ä–∞–Ω–∞
   - **Install source** ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞
   - **A/B test variant** ‚Äî –≥—Ä—É–ø–ø–∞ —Ç–µ—Å—Ç–∞

---

## –ü—É–±–ª–∏–∫–∞—Ü–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥
2. **Edit** ‚Üí –≤–∫–ª—é—á–∏—Ç–µ **Published**
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –¥–∞—à–±–æ—Ä–¥–∞
4. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:
   - **Settings** ‚Üí **List Users** ‚Üí **+ User**
   - Role: **Gamma** (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)

---

## –≠–∫—Å–ø–æ—Ä—Ç/–ò–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–æ–≤

### –≠–∫—Å–ø–æ—Ä—Ç
```bash
# –ß–µ—Ä–µ–∑ UI: Dashboard ‚Üí ... ‚Üí Export
# –ò–ª–∏ —á–µ—Ä–µ–∑ API
curl -X GET "http://localhost:8088/api/v1/dashboard/export/" \
    -H "Authorization: Bearer <token>" \
    -o dashboards.zip
```

### –ò–º–ø–æ—Ä—Ç
```bash
# –ß–µ—Ä–µ–∑ UI: Settings ‚Üí Import Dashboard
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON/ZIP —Ñ–∞–π–ª
```

---

## Troubleshooting

### –ß–∞—Ä—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ ClickHouse
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SQL –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ connection –∫ –±–∞–∑–µ

### –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
- –£–º–µ–Ω—å—à–∏—Ç–µ period –≤ time-series —á–∞—Ä—Ç–∞—Ö

### –û—à–∏–±–∫–∞ "No data to display"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º—ë–Ω –∫–æ–ª–æ–Ω–æ–∫
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Dataset –æ–±–Ω–æ–≤–ª—ë–Ω (Sync columns)
