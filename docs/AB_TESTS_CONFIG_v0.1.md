# A/B Tests Configuration v0.1
## "Idle Champions: Synthetic"

**Статус:** Утверждён  
**Дата:** 2025-02-01  
**Связан с:** GDD v0.2, Event Taxonomy v0.2

---

## 1. Общая концепция

A/B тесты в симуляторе позволяют:
- Генерировать данные с разным поведением групп игроков
- Студентам — анализировать результаты, считать статистическую значимость
- Практиковать принятие продуктовых решений на основе данных

**Принципы:**
- Каждый игрок распределяется в группы при "установке" (детерминированно через seed + user_id)
- Распределение сохраняется на всё время жизни игрока
- Тесты влияют на параметры поведения агента (конверсия, retention, etc.)
- Эффекты реалистичны, но достаточно выражены для обнаружения на учебных объёмах

---

## 2. Механика распределения

```python
def get_ab_group(user_id: str, test_name: str, variants: list, seed: int) -> str:
    """Детерминированное распределение по группам."""
    hash_input = f"{seed}:{test_name}:{user_id}"
    hash_value = int(hashlib.md5(hash_input.encode()).hexdigest(), 16)
    variant_index = hash_value % len(variants)
    return variants[variant_index]
```

- Равномерное распределение по умолчанию
- Можно задать веса для неравномерного распределения
- Один игрок может участвовать в нескольких тестах одновременно

---

## 3. Предзаданные A/B тесты

### 3.1. `onboarding_length`

**Гипотеза:** Короткий туториал улучшает D1 retention, но ухудшает D7 из-за непонимания механик.

| Вариант | Описание | Эффект |
|---------|----------|--------|
| `control` | Стандартный туториал (8 шагов) | Базовые значения |
| `short` | Короткий туториал (4 шага) | D1 +5%, D7 -8% |
| `extended` | Расширенный туториал (12 шагов) | D1 -3%, D7 +4% |

**Распределение:** 33% / 33% / 34%

---

### 3.2. `starter_pack_price`

**Гипотеза:** Более низкая цена увеличивает конверсию, но снижает ARPPU.

| Вариант | Цена | Эффект |
|---------|------|--------|
| `control` | $0.99 | Базовая конверсия |
| `higher` | $1.99 | Конверсия -40%, ARPPU +80% |
| `lower` | $0.49 | Конверсия +60%, ARPPU -45% |

**Распределение:** 33% / 33% / 34%

---

### 3.3. `gacha_pity_display`

**Гипотеза:** Отображение pity-счётчика увеличивает количество призывов.

| Вариант | Описание | Эффект |
|---------|----------|--------|
| `control` | Pity скрыт | Базовое поведение |
| `visible` | Pity показан | +15% призывов при pity > 50 |

**Распределение:** 50% / 50%

---

### 3.4. `energy_regen_rate`

**Гипотеза:** Быстрая регенерация энергии увеличивает сессии, но снижает монетизацию энергии.

| Вариант | Скорость | Эффект |
|---------|----------|--------|
| `control` | 1 energy / 5 min | Базовое поведение |
| `fast` | 1 energy / 4 min | +20% сессий/день, -30% покупок энергии |
| `slow` | 1 energy / 6 min | -15% сессий/день, +25% покупок энергии |

**Распределение:** 33% / 33% / 34%

---

### 3.5. `ad_reward_amount`

**Гипотеза:** Большая награда за рекламу увеличивает просмотры, но каннибализирует IAP.

| Вариант | Награда | Эффект |
|---------|---------|--------|
| `control` | 50 gems | Базовое поведение |
| `generous` | 100 gems | +40% ad views, -10% IAP конверсия |
| `stingy` | 25 gems | -30% ad views, +5% IAP конверсия |

**Распределение:** 33% / 33% / 34%

---

### 3.6. `late_game_offer` ⏰

**Тип:** Временный тест (запускается на day 30+)

**Гипотеза:** Специальное предложение для "застрявших" игроков возвращает их в платящих.

| Вариант | Описание | Эффект |
|---------|----------|--------|
| `control` | Нет предложения | Базовое поведение |
| `discount_50` | -50% на gems_tier3 | +25% конверсия в IAP среди day 30+ игроков |
| `bonus_hero` | Бесплатный Epic герой + предложение | +15% конверсия, +10% D30-D60 retention |

**Условие активации:** days_since_install >= 30
**Распределение:** 33% / 33% / 34%

---

## 4. Формат в событиях

В каждом событии поле `ab_tests` содержит все активные тесты для пользователя:

```json
{
  "ab_tests": {
    "onboarding_length": "short",
    "starter_pack_price": "control",
    "gacha_pity_display": "visible",
    "energy_regen_rate": "fast",
    "ad_reward_amount": "control",
    "late_game_offer": "discount_50"  // появляется только после day 30
  }
}
```

**Примечание:** Временные тесты (как `late_game_offer`) появляются в `ab_tests` только после выполнения условия активации.

---

## 5. Задания для студентов

На основе этих тестов студенты могут:

### 5.1. Базовый анализ
- Посчитать размер групп, проверить равномерность распределения
- Рассчитать ключевые метрики по группам (retention, конверсия, ARPU)
- Построить доверительные интервалы

### 5.2. Статистическая значимость
- Провести t-test / chi-square test
- Рассчитать p-value
- Определить минимальный размер выборки для значимости

### 5.3. Продуктовые решения
- Оценить trade-off (например, retention vs. monetization)
- Рассчитать влияние на LTV
- Сделать рекомендацию о раскатке

### 5.4. Продвинутый анализ
- Найти взаимодействия между тестами
- Сегментировать эффекты (новые vs. старые игроки, платящие vs. нет)
- Построить модель предсказания эффекта

---

## 6. Параметры генератора

При запуске генератора можно:

```python
config = {
    "ab_tests": {
        "onboarding_length": {
            "enabled": True,
            "variants": ["control", "short", "extended"],
            "weights": [0.33, 0.33, 0.34]
        },
        "starter_pack_price": {
            "enabled": True,
            "variants": ["control", "higher", "lower"],
            "weights": [0.33, 0.33, 0.34]
        },
        # ...
    }
}
```

- Включать/выключать отдельные тесты
- Менять распределение по группам
- Добавлять кастомные тесты

---

## 7. Расширение тестов

Архитектура позволяет добавлять новые тесты через конфигурацию:

```python
# Пример добавления нового теста
new_test = {
    "name": "new_feature_test",
    "enabled": True,
    "variants": ["control", "variant_a", "variant_b"],
    "weights": [0.33, 0.33, 0.34],
    "activation_condition": None,  # или "days_since_install >= N"
    "effects": {
        "variant_a": {"retention_d7_modifier": 1.05},
        "variant_b": {"retention_d7_modifier": 0.95}
    }
}
```

---

## Changelog

| Версия | Дата | Изменения |
|--------|------|-----------|
| 0.1 | 2025-02-01 | 6 тестов (5 постоянных + 1 временный). Утверждён. |
